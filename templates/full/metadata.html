<%inherit file="base-ok.html"/>

<%def name="header()">
    <link rel="alternate"
          type="application/vnd.google-earth.kml+xml"
          href="${resource_root}/kml"
          title="MEDIN - ${title}">
</%def>

<%def name="left_menu()">\
<div id="menu-contents">&nbsp;
  <div class="info">
    <h3>Download</h3>
    <p>The complete metadata is available for downloading in the following
      XML metadata formats:</p>
    <ul>
      <li><a href="${resource_root}/DC">Dublin Core format</a></li>
      <li><a href="${resource_root}/DIF_9.4">GCMD DIF format</a> (version 9.4)</li>
      <li><a href="${resource_root}/MEDIN_2.3">MEDIN format</a> (version 2.3.1)</li>
      <li><div><a href="${resource_root}/ISO19115">ISO 19115 format</a> (encoded as ISO 19139 XML)</div></li>
    </ul>
  </div>
</div>
</%def>

<%def name="format_date(date)">
${date.strftime('%A %d %B %Y')}
</%def>

<%def name="format_search_date(date)">
${date.strftime('%Y-%m-%d')}
</%def>

% if bbox:
<div class="extent right">
  <div class="info">
  <h3>Geographic Extent</h3>
  <img class="extent" src="${resource_root}/extent.png" alt="Geographic bounding box" title="Geographic extent of the data"/>
  <p class="no-bottom">
  The metadata covers the area West - East from ${bbox[0]}&deg; to
  ${bbox[2]}&deg; and North - South from ${bbox[3]}&deg; to
  ${bbox[1]}&deg;.

  <a
  href="${script_root}/full/catalogue?bbox=${bbox[0]},${bbox[1]},${bbox[2]},${bbox[3]}"
  title="Area search for metadata">Search</a> for all metadata within
  this area.
  </p>
  </div>
  <p class="lower-link right">
    <a href="${resource_root}/kml" title="View the extent as a KML file"><img alt="KML" width="16" height="16" src="/images/kml.png" class="image_no_border"> KML</a>
  </p>
</div>
% endif

<h2>Overview</h2>

<p><strong>Abstract:</strong> ${abstract}</p>
% if keywords:
<p class="no-bottom"><strong>Keywords:</strong></p>
  % for title, defns in keywords.items():
  <div><strong>${title}</strong></div>
  <div class="subitem">
    % for i, (keyword, defn) in enumerate(defns.items()):
      % if i:
      <div class="sibling">
      % else:
      <div>
      % endif
        <% if defn: keyword = defn['short'] %>
        <a href="${script_root}/full/catalogue?q=${keyword | u}"
           title="Search for all metadata having the keyword '${keyword | x}'">${keyword | x}</a>
        % if defn:
          % if defn['long'] != defn['short']:
          - ${defn['long'] | x}
          % endif
        <br/>Definition: ${defn['defn'] | x}
        % endif
      </div>
    % endfor
  </div>
  % endfor
% endif

<h2>Details</h2>
<p class="no-bottom">Details for the metadata are as follows:</p>

<table summary="Metadata details" class="tabulate">
  % if linkage:
  <tr>
    <td class="heading">
      <div class="cell">
        <strong>Resource locator</strong>
      </div>
    </td>
    <td class="content">
      <div class="cell">
        % for i, resource in enumerate(linkage):
        % if i:
        <div class="sibling">
        % else:
        <div>
        % endif
          <a href="${resource['link']}" title="External link">
            % if resource['name']:
            ${resource['name']}
            % else:
            ${resource['link']}
            % endif
            </a>
          % if resource['description']:
          - ${resource['description']}
          % endif
        </div>
        % endfor
      </div>
    </td>
  </tr>
  % endif

  % if topic_category:
  <tr>
    <td class="heading">
      <div class="cell">
        <strong>Topic category</strong>
      </div>
    </td>
    <td class="content">
      <div class="cell">
        % for i, (keyword, defn) in enumerate(topic_category.items()):
        % if i:
        <div class="sibling">
        % else:
        <div>
        % endif
          % if defn:
          <a href="${script_root}/full/catalogue?q=tc:${defn['short'] | u}"
             title="Search for all metadata having the topic category '${defn['short'] | x}'">${defn['short'] | x}</a>
            % if defn['long'] != defn['short']:
            - ${defn['long'] | x}
            % endif
          <br/>Definition: ${defn['defn'] | x}
          % else:
          ${keyword | x}
          % endif
        </div>
        % endfor
      </div>
    </td>
  </tr>
  % endif

  % if extent:
  <tr>
    <td class="heading">
      <div class="cell">
        <strong>Extent</strong>
      </div>
    </td>
    <td class="content">
      <div class="cell">
        % for i, details in enumerate(extent):
        % if i:
        <div class="sibling">
        % else:
        <div>
        % endif
          ${details['title']}: 
          % if details['id']:
          <a href="${script_root}/full/catalogue?a=${details['id'] | u}"
             title="Search for all metadata in the area '${details['name'] | x}'">${details['name'] | x}</a>
          % else:
          ${details['name'] | x}
          % endif
        </div>
        % endfor
      </div>
    </td>
  </tr>
  % endif

  % if temporal_reference:
  <tr>
    <td class="heading">
      <div class="cell">
        <strong>Temporal reference</strong>
      </div>
    </td>
    <td class="content">
      <div class="cell">
        %if temporal_reference['range']:
        <div>
          The data spans the period from <a href="${script_root}/full/catalogue?sd=${format_search_date(temporal_reference['range'][0])}&amp;ed=${format_search_date(temporal_reference['range'][1])}" title="Search for all records between these dates">${format_date(temporal_reference['range'][0])} to ${format_date(temporal_reference['range'][1])}</a> inclusive.
        </div>
        %endif
        % for i, (code, date) in enumerate(temporal_reference['single']):
        % if i or temporal_reference['range']:
        <div class="sibling">
        % else:
        <div>
        % endif
        ${code.capitalize()} date was ${format_date(date)} [<a href="${script_root}/full/catalogue?ed=${format_search_date(date)}" title="List all previous records">Previous records</a>] [<a href="${script_root}/full/catalogue?sd=${format_search_date(date)}" title="List all subsequent records">Subsequent records</a>]
        </div>
        % endfor
      </div>
    </td>
  </tr>
  % endif
  
  % for name, details in metadata:
  <tr>
    <td class="heading">
      <div class="cell">
        <strong>${name}</strong>
      </div>
    </td>
    <td class="content">
      <div class="cell">
        % for i, detail in enumerate(details):
        % if i:
        <div class="sibling">
        % else:
        <div>
        % endif
        ${detail}</div>
        % endfor
      </div>
    </td>
  </tr>
  % endfor
</table>
