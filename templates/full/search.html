<%inherit file="base.html"/>

<%def name="header()">
    <style type="text/css">
        #map {
            width: 100%;
            height: 400px;
            border: 1px solid black;
        }
    </style>
    <script type="text/javascript" src="/js/openlayers/OpenLayers.js"></script>
    <script type="text/javascript">
        <!--
var map, layer;
%if bbox:
var bbox = new OpenLayers.Bounds(${bbox[0]}, ${bbox[1]}, ${bbox[2]}, ${bbox[3]});
%else:
var bbox = null;
%endif

function init(){
    var extent = new OpenLayers.Bounds(-180, -90, 180, 90);
    var options = {
        restrictedExtent: extent,
        maxResolution: 360/512
    }
    
    map = new OpenLayers.Map( $('map'), options);
    layer = new OpenLayers.Layer.TMS( "Bathy", 
                                      "${script_root}/spatial/tms/",
                                      { layername: 'bathymetry', type: 'png' } );
    map.addLayer(layer);
    map.addControl(new OpenLayers.Control.Permalink());

    if (!bbox) {
        map.setCenter(extent, 1);
        return;
    }

    map.zoomToExtent(bbox);
    var boxes = new OpenLayers.Layer.Boxes("boxes");
    var box = new OpenLayers.Marker.Box(bbox);
    boxes.addMarker(box);
    map.addLayer(boxes);
}

// Ensure any other loader gets called
// Code from http://blog.roberthahn.ca/articles/2007/02/02/how-to-use-window-onload-the-right-way/
function makeDoubleDelegate(function1, function2) {
    return function() {
        if (function1)
            function1();
        if (function2)
            function2();
    }
}

window.onload = makeDoubleDelegate(window.onload, init);
        // -->
    </script>
</%def>

<p>Search the MEDIN Data Archive Centres.</p>

<form method="GET" action="${resource_root}/catalogue">
  <input type="text" name="q"\
  %if search_term:
 value="${search_term}"
  %endif
/>
  %if sort:
  <input name="s" type="hidden" value="${sort}" />
  %endif
  %if count:
  <input name="c" type="hidden" value="${count}" />
  %endif
  %if bbox:
  <input name="bbox" type="hidden" value="${','.join(bbox)}" />
  %endif
  <input type="submit" value="search"/>
</form>

<div id="map"></div>
